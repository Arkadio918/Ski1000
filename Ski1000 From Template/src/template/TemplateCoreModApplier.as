package template 
{
	import Bezel.Lattice.Lattice;
	/**
	 * ...
	 * @author Chris
	 */
	public class TemplateCoreModApplier 
	{
		internal static const VERSION:String = "1";
		internal static function installCoremods(lattice:Lattice):void
		{
			// lattice.doesFileExist allows you to possibly check versions of a game, as well as which game the mod is running on
			// Because GCFW and GCCS are so similar, this mod can work for both with a little modification
			if (lattice.doesFileExist("com/giab/games/gcfw/Main.class.asasm"))
			{
				TemplateCoreMod.logger.log("installCoremods", "Found GCFW, installing coremod");
				installTemplateCoremod(lattice, "gcfw");
			}
			else
			{
				TemplateCoreMod.logger.log("installCoremods", "Found GCCS, installing coremod");
				installTemplateCoremod(lattice, "gccs/steam");
			}
		}
		
		private static function installTemplateCoremod(lattice:Lattice, baseGame:String):void
		{
			// First, decide which file you need to edit. Classes' files are named <package>.<class name>.class.asasm
			var filename:String = "com/giab/games/" + baseGame + "/selector/PnlSkills.class.asasm";
			// Then find the line that you need to edit. This is done through searching for snippets around where you want to edit
			// Note that for some edits, the same line might appear twice. This is fine, it just means that you need to add more context
			// so that you don't edit the wrong location
			var offset:int = lattice.findPattern(filename,/getproperty.*shiftKey/);
			// If the result returned is -1, then that pattern is not present in the file. It's possible the game may have updated, making the coremod
			// no longer valid. I recommend logging this, as it could help debugging issues later.
			if (offset == -1)
			{
				TemplateCoreMod.logger.log("installTemplateCoremod", "Could not find proper place to apply gem coremod!");
				return;
			}

			// Finally, add or edit your line. Because we're replacing a line, we use the offset - 1 as our location, and 1 to indicate the number of lines we replace.
			// In order to add one or more lines without removing the original, just use 0 for replaceLines.
			lattice.patchFile(filename, offset - -4, 0, "getlocal1\n \	getproperty QName(PackageNamespace(\"\"),\"ctrlKey\")\n \	iftrue IfCtrlTrue\n \IfCtrlTrue:\n \	getlocal1\n \	getproperty QName(PackageNamespace(\"\"),\"delta\")\n \	pushshort 0\n \	ifngt FroI1kSell\n \	pushshort 0\n \	setlocal2\n \	jump FroI1kBuy\n \FroI1kBuy:\n \	getlocal2\n \	pushshort 1000\n \	iflt BuySkillX1K\n \	jump RenderButtonIDK\n \BuySkillX1K:\n \	label\n \	getlocal0\n \	getlocal1\n \	getproperty QName(PackageNamespace(\"\"),\"target\")\n \	getproperty Multiname(\"parent\",[PrivateNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),PackageNamespace(\"\"),PrivateNamespace(\"PnlSkills.as$729\"),PackageNamespace(\"com.giab.games.gcfw.selector\"),PackageInternalNs(\"com.giab.games.gcfw.selector\"),Namespace(\"http://adobe.com/AS3/2006/builtin\"),ProtectedNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),StaticProtectedNs(\"com.giab.games.gcfw.selector:PnlSkills\")])\n \	getproperty Multiname(\"id\",[PrivateNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),PackageNamespace(\"\"),PrivateNamespace(\"PnlSkills.as$729\"),PackageNamespace(\"com.giab.games.gcfw.selector\"),PackageInternalNs(\"com.giab.games.gcfw.selector\"),Namespace(\"http://adobe.com/AS3/2006/builtin\"),ProtectedNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),StaticProtectedNs(\"com.giab.games.gcfw.selector:PnlSkills\")])\n \	callpropvoid QName(PackageNamespace(\"\"),\"buySkill\"), 1\n \	inclocal_i 2\n \RenderButtonIDK:\n \	getlocal0\n \	callpropvoid QName(PackageNamespace(\"\"),\"renderSkillButtons\"), 0\n \	getlocal0\n \	getlocal1\n \	getproperty QName(PackageNamespace(\"\"),\"target\")\n \	getproperty Multiname(\"parent\",[PrivateNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),PackageNamespace(\"\"),PrivateNamespace(\"PnlSkills.as$729\"),PackageNamespace(\"com.giab.games.gcfw.selector\"),PackageInternalNs(\"com.giab.games.gcfw.selector\"),Namespace(\"http://adobe.com/AS3/2006/builtin\"),ProtectedNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),StaticProtectedNs(\"com.giab.games.gcfw.selector:PnlSkills\")])\n \	getproperty Multiname(\"id\",[PrivateNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),PackageNamespace(\"\"),PrivateNamespace(\"PnlSkills.as$729\"),PackageNamespace(\"com.giab.games.gcfw.selector\"),PackageInternalNs(\"com.giab.games.gcfw.selector\"),Namespace(\"http://adobe.com/AS3/2006/builtin\"),ProtectedNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),StaticProtectedNs(\"com.giab.games.gcfw.selector:PnlSkills\")])\n \	callpropvoid QName(PackageNamespace(\"\"),\"renderInfoPanelSkill\"), 1\n \	getlocal1\n \	getproperty QName(PackageNamespace(\"\"),\"target\")\n \	getproperty Multiname(\"parent\",[PrivateNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),PackageNamespace(\"\"),PrivateNamespace(\"PnlSkills.as$729\"),PackageNamespace(\"com.giab.games.gcfw.selector\"),PackageInternalNs(\"com.giab.games.gcfw.selector\"),Namespace(\"http://adobe.com/AS3/2006/builtin\"),ProtectedNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),StaticProtectedNs(\"com.giab.games.gcfw.selector:PnlSkills\")])\n \	getproperty Multiname(\"frame\",[PrivateNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),PackageNamespace(\"\"),PrivateNamespace(\"PnlSkills.as$729\"),PackageNamespace(\"com.giab.games.gcfw.selector\"),PackageInternalNs(\"com.giab.games.gcfw.selector\"),Namespace(\"http://adobe.com/AS3/2006/builtin\"),ProtectedNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),StaticProtectedNs(\"com.giab.games.gcfw.selector:PnlSkills\")])\n \	getlocal1\n \	getproperty QName(PackageNamespace(\"\"),\"target\")\n \	getproperty Multiname(\"parent\",[PrivateNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),PackageNamespace(\"\"),PrivateNamespace(\"PnlSkills.as$729\"),PackageNamespace(\"com.giab.games.gcfw.selector\"),PackageInternalNs(\"com.giab.games.gcfw.selector\"),Namespace(\"http://adobe.com/AS3/2006/builtin\"),ProtectedNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),StaticProtectedNs(\"com.giab.games.gcfw.selector:PnlSkills\")])\n \	getproperty Multiname(\"frame\",[PrivateNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),PackageNamespace(\"\"),PrivateNamespace(\"PnlSkills.as$729\"),PackageNamespace(\"com.giab.games.gcfw.selector\"),PackageInternalNs(\"com.giab.games.gcfw.selector\"),Namespace(\"http://adobe.com/AS3/2006/builtin\"),ProtectedNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),StaticProtectedNs(\"com.giab.games.gcfw.selector:PnlSkills\")])\n \	getproperty Multiname(\"currentFrame\",[PrivateNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),PackageNamespace(\"\"),PrivateNamespace(\"PnlSkills.as$729\"),PackageNamespace(\"com.giab.games.gcfw.selector\"),PackageInternalNs(\"com.giab.games.gcfw.selector\"),Namespace(\"http://adobe.com/AS3/2006/builtin\"),ProtectedNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),StaticProtectedNs(\"com.giab.games.gcfw.selector:PnlSkills\")])\n \	pushshort 2\n \	equals\n \	iffalse FalseX1\n \	pushshort 1\n \	coerce_a\n \	jump JumpX1\n \FalseX1:\n \	pushshort 3\n \	coerce_a\n \JumpX1:\n \	callpropvoid Multiname(\"gotoAndStop\",[PrivateNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),PackageNamespace(\"\"),PrivateNamespace(\"PnlSkills.as$729\"),PackageNamespace(\"com.giab.games.gcfw.selector\"),PackageInternalNs(\"com.giab.games.gcfw.selector\"),Namespace(\"http://adobe.com/AS3/2006/builtin\"),ProtectedNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),StaticProtectedNs(\"com.giab.games.gcfw.selector:PnlSkills\")]), 1\n \	getlocal1\n \	getproperty QName(PackageNamespace(\"\"),\"target\")\n \	getproperty Multiname(\"parent\",[PrivateNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),PackageNamespace(\"\"),PrivateNamespace(\"PnlSkills.as$729\"),PackageNamespace(\"com.giab.games.gcfw.selector\"),PackageInternalNs(\"com.giab.games.gcfw.selector\"),Namespace(\"http://adobe.com/AS3/2006/builtin\"),ProtectedNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),StaticProtectedNs(\"com.giab.games.gcfw.selector:PnlSkills\")])\n \	getproperty Multiname(\"mcPlus\",[PrivateNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),PackageNamespace(\"\"),PrivateNamespace(\"PnlSkills.as$729\"),PackageNamespace(\"com.giab.games.gcfw.selector\"),PackageInternalNs(\"com.giab.games.gcfw.selector\"),Namespace(\"http://adobe.com/AS3/2006/builtin\"),ProtectedNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),StaticProtectedNs(\"com.giab.games.gcfw.selector:PnlSkills\")])\n \	getlocal0\n \	getlocal1\n \	getproperty QName(PackageNamespace(\"\"),\"target\")\n \	getproperty Multiname(\"parent\",[PrivateNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),PackageNamespace(\"\"),PrivateNamespace(\"PnlSkills.as$729\"),PackageNamespace(\"com.giab.games.gcfw.selector\"),PackageInternalNs(\"com.giab.games.gcfw.selector\"),Namespace(\"http://adobe.com/AS3/2006/builtin\"),ProtectedNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),StaticProtectedNs(\"com.giab.games.gcfw.selector:PnlSkills\")])\n \	getproperty Multiname(\"id\",[PrivateNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),PackageNamespace(\"\"),PrivateNamespace(\"PnlSkills.as$729\"),PackageNamespace(\"com.giab.games.gcfw.selector\"),PackageInternalNs(\"com.giab.games.gcfw.selector\"),Namespace(\"http://adobe.com/AS3/2006/builtin\"),ProtectedNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),StaticProtectedNs(\"com.giab.games.gcfw.selector:PnlSkills\")])\n \	callproperty QName(PackageNamespace(\"\"),\"canBuySkill\"), 1\n \	setproperty Multiname(\"visible\",[PrivateNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),PackageNamespace(\"\"),PrivateNamespace(\"PnlSkills.as$729\"),PackageNamespace(\"com.giab.games.gcfw.selector\"),PackageInternalNs(\"com.giab.games.gcfw.selector\"),Namespace(\"http://adobe.com/AS3/2006/builtin\"),ProtectedNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),StaticProtectedNs(\"com.giab.games.gcfw.selector:PnlSkills\")])\n \	getlocal1\n \	getproperty QName(PackageNamespace(\"\"),\"target\")\n \	getproperty Multiname(\"parent\",[PrivateNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),PackageNamespace(\"\"),PrivateNamespace(\"PnlSkills.as$729\"),PackageNamespace(\"com.giab.games.gcfw.selector\"),PackageInternalNs(\"com.giab.games.gcfw.selector\"),Namespace(\"http://adobe.com/AS3/2006/builtin\"),ProtectedNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),StaticProtectedNs(\"com.giab.games.gcfw.selector:PnlSkills\")])\n \	getproperty Multiname(\"mcMinus\",[PrivateNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),PackageNamespace(\"\"),PrivateNamespace(\"PnlSkills.as$729\"),PackageNamespace(\"com.giab.games.gcfw.selector\"),PackageInternalNs(\"com.giab.games.gcfw.selector\"),Namespace(\"http://adobe.com/AS3/2006/builtin\"),ProtectedNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),StaticProtectedNs(\"com.giab.games.gcfw.selector:PnlSkills\")])\n \	getlocal0\n \	getlocal1\n \getproperty QName(PackageNamespace(\"\"),\"target\")\n \	getproperty Multiname(\"parent\",[PrivateNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),PackageNamespace(\"\"),PrivateNamespace(\"PnlSkills.as$729\"),PackageNamespace(\"com.giab.games.gcfw.selector\"),PackageInternalNs(\"com.giab.games.gcfw.selector\"),Namespace(\"http://adobe.com/AS3/2006/builtin\"),ProtectedNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),StaticProtectedNs(\"com.giab.games.gcfw.selector:PnlSkills\")])\n \	getproperty Multiname(\"id\",[PrivateNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),PackageNamespace(\"\"),PrivateNamespace(\"PnlSkills.as$729\"),PackageNamespace(\"com.giab.games.gcfw.selector\"),PackageInternalNs(\"com.giab.games.gcfw.selector\"),Namespace(\"http://adobe.com/AS3/2006/builtin\"),ProtectedNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),StaticProtectedNs(\"com.giab.games.gcfw.selector:PnlSkills\")])\n \	callproperty QName(PackageNamespace(\"\"),\"canSellSkill\"), 1\n \	setproperty Multiname(\"visible\",[PrivateNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),PackageNamespace(\"\"),PrivateNamespace(\"PnlSkills.as$729\"),PackageNamespace(\"com.giab.games.gcfw.selector\"),PackageInternalNs(\"com.giab.games.gcfw.selector\"),Namespace(\"http://adobe.com/AS3/2006/builtin\"),ProtectedNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),StaticProtectedNs(\"com.giab.games.gcfw.selector:PnlSkills\")])\n \FroI1kSell:\n \	pushshort 0\n \	setlocal2\n \	jump FroI1kSellX2\n \FroI1kSellX2:\n \	getlocal2\n \	pushshort 1000\n \	iflt SellSkillX1k\n \SellSkillX1k:\n \	label\n \	getlocal0\n \	getlocal1\n \	getproperty QName(PackageNamespace(\"\"),\"target\")\n \	getproperty Multiname(\"parent\",[PrivateNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),PackageNamespace(\"\"),PrivateNamespace(\"PnlSkills.as$729\"),PackageNamespace(\"com.giab.games.gcfw.selector\"),PackageInternalNs(\"com.giab.games.gcfw.selector\"),Namespace(\"http://adobe.com/AS3/2006/builtin\"),ProtectedNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),StaticProtectedNs(\"com.giab.games.gcfw.selector:PnlSkills\")])\n \	getproperty Multiname(\"id\",[PrivateNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),PackageNamespace(\"\"),PrivateNamespace(\"PnlSkills.as$729\"),PackageNamespace(\"com.giab.games.gcfw.selector\"),PackageInternalNs(\"com.giab.games.gcfw.selector\"),Namespace(\"http://adobe.com/AS3/2006/builtin\"),ProtectedNamespace(\"com.giab.games.gcfw.selector:PnlSkills\"),StaticProtectedNs(\"com.giab.games.gcfw.selector:PnlSkills\")])\n \	callpropvoid QName(PackageNamespace(\"\"),\"sellSkill\"), 1\n \	inclocal_i 2\n \	");
		}
	}

}
